AC_INIT(raceintospace.spec)

dnl Specify directory for local macros
AC_CONFIG_MACRO_DIR([m4])

dnl Get the operating system and version number...
uname=`uname`

AC_PROG_CC
AC_C_INLINE
AC_C_BIGENDIAN(AC_DEFINE([__BIG_ENDIAN__]))

AC_CHECK_LIB(vorbisfile,main)
AC_CHECK_LIB(asound,main)
AC_CHECK_LIB(m,main)
AC_CHECK_LIB([SDL],main)
dnl avcodec depends on avformat so just test the former
AC_CHECK_LIB(ogg,ogg_stream_init,
[
	AC_DEFINE([HAVE_LIBOGG])
	AC_SUBST(have_ogg, yes)
	AC_CHECK_LIB(theora,theora_decode_init,
	[
		AC_DEFINE([HAVE_LIBTHEORA])
		AC_SUBST(have_theora, yes)
	])
	AC_CHECK_LIB(vorbis,vorbis_synthesis,
	[
		AC_DEFINE([HAVE_LIBVORBIS])
		AC_SUBST(have_vorbis, yes)
	])
])

AX_CREATE_STDINT_H(int_types.h)

dnl cross-compile specific configuration
case "$target" in
i?86-mingw32msvc)
	dnl Windows/CygWin configuration
	LIBS="$LIBS `sdl-config --libs`"
	PROG_NAME=raceintospace.exe
	;;
*)
	dnl Everyone else
	PROG_NAME=raceintospace
	LIBS="$LIBS `sdl-config --libs`"
	;;
esac

case "$uname" in
Darwin)
	dnl Darwin/Mac OS X configuration
	AC_DEFINE([CONFIG_MACOSX])
	;;
Linux)
	dnl Linux OS
	;;
CYGWIN*)
	dnl Cygwin
	dnl CYGWIN already defines __CYGWIN__
	;;
*)
	dnl unknown system
	;;
esac

AC_SUBST(PROG_NAME)

AC_CONFIG_HEADER(race.h)
AC_OUTPUT(Makefile, chmod a-w Makefile race.h)
